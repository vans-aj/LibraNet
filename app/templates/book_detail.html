{% extends "base.html" %}

{% block content %}
<div class="book-detail-page">
    <div class="book-detail-container">
        <a href="{{ url_for('main.list_books') }}" class="back-link">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Catalog</span>
        </a>

        <div class="book-detail-grid">
            <div class="book-cover-wrapper">
                <img
                    src="{{ book.image_url or url_for('static', filename='images/default_cover.jpg') }}"
                    alt="Cover of {{ book.title }}"
                    class="book-cover-image"
                >
                <div class="availability-status">
                    {% if book.available_copies > 0 %}
                        <span class="status-pill available">
                            <i class="fas fa-check-circle"></i> Available
                        </span>
                    {% else %}
                        <span class="status-pill unavailable">
                            <i class="fas fa-times-circle"></i> Unavailable
                        </span>
                    {% endif %}
                </div>
            </div>

            <div class="book-info-wrapper">
                <header class="book-main-info">
                    <h1 class="book-main-title">{{ book.title }}</h1>
                    <p class="book-main-author">by {{ book.author }}</p>
                </header>

                <div class="book-meta-grid">
                    <div class="meta-item">
                        <span class="meta-label">ISBN</span>
                        <span class="meta-value">{{ book.isbn or 'N/A' }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Total Copies</span>
                        <span class="meta-value">{{ book.total_copies }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Available</span>
                        <span class="meta-value">{{ book.available_copies }}</span>
                    </div>
                     {% if book.related_courses %}
                    <div class="meta-item">
                        <span class="meta-label">Related Courses</span>
                        <p class="meta-value">{{ book.related_courses }}</p>
                    </div>
                    {% endif %}
                </div>

                {% if book.summary %}
                <div class="book-summary">
                    <h2>Summary</h2>
                    <p>{{ book.summary }}</p>
                </div>
                {% endif %}

                <div class="book-actions">
                    <form action="{{ url_for('main.add_to_bag', book_id=book.id) }}" method="post">
                        {% if book.available_copies > 0 %}
                            <button type="submit" class="action-btn primary-action">
                                <i class="fas fa-shopping-bag"></i>
                                <span>Add to Bag</span>
                            </button>
                        {% else %}
                            <button type="button" class="action-btn disabled-action" disabled>
                                <i class="fas fa-ban"></i>
                                <span>Out of Stock</span>
                            </button>
                        {% endif %}
                    </form>
                </div>

                 {% if existing_loan %}
                <div class="loan-info-alert">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <h4>Already on Loan</h4>
                        <p>You are currently borrowing this book. It is due on {{ existing_loan.due_date.strftime('%B %d, %Y') }}.</p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}