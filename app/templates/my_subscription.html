{% extends "base.html" %}

{% block content %}
<div class="loans-page"> <div class="loans-header">
        <h1>My Subscription</h1>
        <p>Manage your current plan and view history</p>
    </div>

    <div class="loans-content">

        <div class="sub-card" style="margin-bottom: 30px; background: #fff; border: 1px solid #e0e0e0; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <div class="sub-card-header" style="padding: 20px 25px; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h2 style="margin: 0; font-size: 1.5rem;">Current Plan: {{ plan.name }}</h2>
                    {% if subscription.tier.name != 'FREE' %}
                        <p style="margin: 5px 0 0; color: #555;">
                            Renews on: {{ subscription.end_date.strftime('%d %b %Y') }}
                            ({{ subscription.days_remaining }} days remaining)
                        </p>
                    {% else %}
                        <p style="margin: 5px 0 0; color: #555;">You are on the free plan.</p>
                    {% endif %}
                </div>
                {% if subscription.tier.name != 'FREE' %}
                    <form action="{{ url_for('main.cancel_subscription') }}" method="POST" onsubmit="return confirm('Are you sure you want to cancel? You will be downgraded to the Free plan.');">
                        <button type="submit" class="btn-view-book" style="background: #ef4444; color: white;">Cancel Plan</button>
                    </form>
                {% else %}
                    <a href="{{ url_for('main.subscriptions') }}" class="btn-view-book" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">Upgrade Plan</a>
                {% endif %}
            </div>
            
            <div class="sub-card-body" style="padding: 25px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3 style="font-size: 1.2rem; margin-top: 0;">Features</h3>
                    <ul style="list-style: none; padding-left: 0; margin: 0;">
                        {% for feature in plan.features %}
                            <li style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                <i class="fas fa-check-circle" style="color: #10b981;"></i>
                                <span>{{ feature }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                <div>
                    <h3 style="font-size: 1.2rem; margin-top: 0;">Restrictions</h3>
                    <ul style="list-style: none; padding-left: 0; margin: 0;">
                        {% if plan.restrictions %}
                            {% for restriction in plan.restrictions %}
                                <li style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                    <i class="fas fa-times-circle" style="color: #ef4444;"></i>
                                    <span>{{ restriction }}</span>
                                </li>
                            {% endfor %}
                        {% else %}
                             <li style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                <i class="fas fa-check-circle" style="color: #10b981;"></i>
                                <span>No restrictions!</span>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>

        <div classs="history-section">
            <h2>Subscription History</h2>
            {% if subscription_history %}
                <div class="loans-table-wrapper">
                    <table class="loans-table">
                        <thead>
                            <tr>
                                <th>Plan</th>
                                <th>Price Paid</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sub in subscription_history %}
                            <tr>
                                <td>{{ sub.tier.value.title() }}</td>
                                <td>â‚¹{{ '%.2f'|format(sub.price_paid) }}</td>
                                <td>{{ sub.start_date.strftime('%d %b %Y') }}</td>
                                <td>{{ sub.end_date.strftime('%d %b %Y') if sub.end_date else 'N/A' }}</td>
                                <td>
                                    {% if sub.is_active %}
                                        <span class="status-badge active">Active</span>
                                    {% else %}
                                        <span class="status-badge returned">Expired/Cancelled</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                 <div class="empty-state">
                    <div class="empty-icon">ðŸ§¾</div>
                    <h2>No History</h2>
                    <p>Your subscription history will appear here.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}